# 需求文档 - K3 框架 UI 组件创建功能

## 1. 项目现状与核心目标

### 1.1 用户需求简述

需要提供一个命令来在 Unity 预制体中创建 K3 框架的 UI 组件：

**k3prefab.createComponent**: 在预制体中创建新的 K3UI 组件（K3Button、K3Label、K3Image 等）

### 1.2 项目现状

- 项目已有完善的 UnityAgentSkills 命令系统，位于`Code/Assets/Editor/UnityAgentSkills/`
- 前置能力(依赖): 本功能依赖 K3 组件查询与修改能力,需先具备 `k3prefab.queryByK3Id`,`k3prefab.setComponentProperties`
- 项目已有 K3UI 组件创建的编辑器工具，位于`Code/Assets/Editor/K3Component/UIMenuOptions.cs`
- 编辑器菜单 `GameObject/K3UI/` 下提供了 20+ 种 K3UI 组件的创建功能
- **插件化架构**: k3prefab 命令通过 `UnityAgentSkills.Plugins.K3Prefab.K3PrefabPlugin` 提供(Priority 100)
- **实现文件**: `Code/Assets/Editor/UnityAgentSkills/Plugins/K3Prefab/K3PrefabPlugin.cs`
- **可移除性**: K3Prefab 插件是完全可移除的项目专用能力,删除 K3Prefab 文件夹不影响项目编译

### 1.3 核心目标

- 将编辑器菜单中的 K3UI 组件创建功能迁移到 UnityAgentSkills 命令系统
- 让外部工具通过 JSON 命令在预制体中创建 K3UI 组件
- 支持创建所有编辑器菜单中支持的 K3UI 组件类型
- 自动处理 K3ID 分配、父节点关系、组件属性初始化
- 支持批量创建多个组件
- 支持自定义组件初始属性

### 1.4 K3 框架核心概念

**K3ID 自动分配机制**：

- K3ID 由父容器的 `K3Property.maxID` 自动分配
- 创建新组件时，会从父容器获取当前的 `maxID` 作为新组件的 ID
- 创建后，父容器的 `maxID` 会自动递增
- 新组件的 `parentID` 设置为父容器的 ID

**支持的 K3UI 组件类型**：

编辑器菜单 `GameObject/K3UI/` 中支持的组件类型包括：

| 序号 | 组件名称          | 类名              | 说明         |
| ---- | ----------------- | ----------------- | ------------ |
| 0    | K3Label           | K3Label           | 文本标签     |
| 1    | K3Button          | K3Button          | 按钮         |
| 2    | K3Panel           | K3Panel           | 面板容器     |
| 3    | K3Image           | K3Image           | 图片         |
| 4    | K3Animation       | K3Animation       | 动画         |
| 5    | K3Edit            | K3Edit            | 输入框       |
| 6    | K3CheckBox        | K3CheckBox        | 复选框       |
| 7    | K3ListView        | K3ListView        | 列表视图     |
| 8    | K3Dialog          | K3Dialog          | 对话框       |
| 9    | K3TabButton       | K3TabButton       | 标签页按钮   |
| 10   | K3Tab             | K3Tab             | 标签页容器   |
| 11   | K3ProgressBar     | K3ProgressBar     | 进度条       |
| 12   | K3NumImage        | K3NumImage        | 数字图片     |
| 13   | K3Itembox         | K3Itembox         | 物品格       |
| 14   | K3LabelButton     | K3LabelButton     | 标签按钮     |
| 15   | K3JoyStick        | K3JoyStick        | 虚拟摇杆     |
| 16   | K3SliderBar       | K3SliderBar       | 滑动条       |
| 17   | K3Magicbox        | K3Magicbox        | 魔法箱       |
| 18   | K3LinkLabel       | K3LinkLabel       | 链接标签     |
| 19   | K3Dialog2         | K3Dialog2         | 对话框 2     |
| 20   | K3Movie           | K3Movie           | 视频         |
| 21   | K3RadarChart      | K3RadarChart      | 雷达图       |
| 22   | K3HeadIcon        | K3HeadIcon        | 头像图标     |
| 23   | K3ExpandListView  | K3ExpandListView  | 可展开列表   |
| 24   | K3ExpandListPanel | K3ExpandListPanel | 展开列表面板 |
| 25   | K3TabDialog       | K3TabDialog       | Tab 对话框   |
| 1002 | K3InsightImage    | K3InsightImage    | 洞察图片     |

## 2. 范围与边界

### 2.1 功能点简述

**命令: k3prefab.createComponent**

- [ ] 接收预制体路径、父节点路径、组件类型，创建新的 K3UI 组件
- [ ] 支持所有编辑器菜单中的 K3UI 组件类型
- [ ] 自动分配 K3ID（基于父容器的 maxID）
- [ ] 自动设置父子关系和 K3Property
- [ ] 支持设置组件初始属性（可选）
- [ ] 支持批量创建多个组件
- [ ] 创建后自动保存预制体
- [ ] 返回创建的组件完整信息（包括分配的 K3ID）

### 2.2 排除项

- 不支持创建 K3 框架之外的 Unity 组件
- 不支持删除组件（使用现有的 Unity 编辑器功能）
- 不支持移动组件（使用现有的 Unity 编辑器功能）
- 不支持修改运行时实例（仅支持预制体文件）
- 不支持创建容器组件（K3Dialog、K3Panel）的复杂嵌套场景（仅支持简单的创建）

## 3. 输入协议

### 3.1 命令: k3prefab.createComponent

#### 输入示例

```json
{
  "batchId": "batch_create_k3ui_001",
  "timeout": 30000,
  "commands": [
    {
      "id": "cmd_create_button",
      "type": "k3prefab.createComponent",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "parentPath": "DialogMain/Panel_Content",
        "componentType": "K3Button",
        "initialProperties": {
          "interactable": true,
          "alpha": 1.0
        }
      }
    },
    {
      "id": "cmd_create_label",
      "type": "k3prefab.createComponent",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "parentPath": "DialogMain/Panel_Content",
        "componentType": "K3Label",
        "initialProperties": {
          "text": "Hello World",
          "fontSize": 22,
          "color": "NormalBai"
        }
      }
    }
  ]
}
```

#### params 字段定义

| 参数名            | 类型   | 必填 | 默认值 | 说明                                                                           |
| ----------------- | ------ | ---- | ------ | ------------------------------------------------------------------------------ |
| prefabPath        | string | 是   | -      | 预制体绝对路径                                                                 |
| parentPath        | string | 是   | -      | 父节点 GameObject 路径（必须是实现 IK3Container 的节点，如 K3Dialog、K3Panel） |
| componentType     | string | 是   | -      | K3UI 组件类型名（如 "K3Button"、"K3Label"、"K3Image" 等）                      |
| initialProperties | object | 否   | {}     | 组件初始属性（可选），不同组件类型支持不同的属性                               |

#### initialProperties 支持的属性

**通用属性（所有 K3UI 组件都支持）**：

- `alpha`: number - 透明度 (0.0 - 1.0)
- `interactable`: boolean - 是否可交互（仅适用于可交互组件）

**K3Label 特有属性**：

- `text`: string - 文本内容
- `fontSize`: number - 字体大小
- `color`: string - 颜色（使用 K3DefaultControls 中定义的颜色名，如 "NormalBai"、"ColorHong" 等）

**K3Button 特有属性**：

- `interactable`: boolean - 是否可交互
- `alpha`: number - 透明度

**K3Image 特有属性**：

- `sprite`: string - 精灵图片名称（从默认图集中加载）
- `type`: string - 图片类型（"Simple"、"Sliced"、"Tiled"、"Filled"）

**其他组件类型的初始属性**：

- 根据组件的实际序列化字段支持

## 4. 输出协议

### 4.1 成功输出示例

```json
{
  "batchId": "batch_create_k3ui_001",
  "status": "completed",
  "startedAt": "YYYY-MM-DD HH:mm:ss.SSS",
  "finishedAt": "YYYY-MM-DD HH:mm:ss.SSS",
  "results": [
    {
      "id": "cmd_create_button",
      "type": "k3prefab.createComponent",
      "status": "success",
      "startedAt": "YYYY-MM-DD HH:mm:ss.SSS",
      "finishedAt": "YYYY-MM-DD HH:mm:ss.SSS",
      "result": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "parentPath": "DialogMain/Panel_Content",
        "componentType": "K3Button",
        "gameObject": {
          "name": "K3Button_6",
          "path": "DialogMain/Panel_Content/K3Button_6",
          "instanceID": 123456789
        },
        "k3Component": {
          "type": "K3Button",
          "properties": {
            "ID": 6,
            "parentID": 3,
            "maxID": 7,
            "interactable": true,
            "alpha": 1.0
          }
        },
        "saved": true
      }
    }
  ],
  "totalCommands": 1,
  "successCount": 1,
  "failedCount": 0
}
```

#### result 字段定义

- `prefabPath`: string, 预制体路径
- `parentPath`: string, 父节点路径
- `componentType`: string, 组件类型
- `gameObject`: object, 创建的 GameObject 信息
  - `name`: string, GameObject 名称（格式：组件类型\_ID，如 "K3Button_6"）
  - `path`: string, GameObject 完整路径
  - `instanceID`: number, Unity InstanceID
- `k3Component`: object, K3 组件信息
  - `type`: string, K3 组件类型
  - `properties`: object, K3 组件属性
    - `ID`: number, 分配的 K3ID
    - `parentID`: number, 父容器 ID
    - `maxID`: number, 父容器更新后的 maxID
    - 其他组件特定属性
- `saved`: boolean, 预制体是否已保存

### 4.2 错误输出示例

**预制体不存在**：

```json
{
  "results": [
    {
      "id": "cmd_invalid_prefab",
      "type": "k3prefab.createComponent",
      "status": "error",
      "error": {
        "code": "PREFAB_NOT_FOUND",
        "message": "预制体文件不存在: Assets/notexist.prefab",
        "detail": "请检查预制体路径是否正确"
      }
    }
  ]
}
```

**父节点不是容器**：

```json
{
  "results": [
    {
      "id": "cmd_invalid_parent",
      "type": "k3prefab.createComponent",
      "status": "error",
      "error": {
        "code": "INVALID_PARENT_CONTAINER",
        "message": "父节点不是有效的 K3 容器",
        "detail": "父节点必须实现 IK3Container 接口（如 K3Dialog、K3Panel）"
      }
    }
  ]
}
```

**组件类型不支持**：

```json
{
  "results": [
    {
      "id": "cmd_invalid_type",
      "type": "k3prefab.createComponent",
      "status": "error",
      "error": {
        "code": "UNSUPPORTED_COMPONENT_TYPE",
        "message": "不支持的组件类型: InvalidType",
        "detail": "支持的类型包括: K3Button, K3Label, K3Image, K3Edit, K3CheckBox 等"
      }
    }
  ]
}
```

## 5. 举例覆盖需求和边缘情况

### 5.1 基本创建示例

**例 1: 创建一个 K3Button**

- 输入：

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "parentPath": "DialogMain/Panel_Content",
    "componentType": "K3Button"
  }
}
```

- 预期：
  - 在 `DialogMain/Panel_Content` 下创建一个 K3Button
  - 自动分配 K3ID（假设为 6）
  - GameObject 命名为 `K3Button_6`
  - 返回创建的组件信息

**例 2: 创建一个 K3Label 并设置初始文本**

- 输入：

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "parentPath": "DialogMain/Panel_Content",
    "componentType": "K3Label",
    "initialProperties": {
      "text": "确认退出",
      "fontSize": 22,
      "color": "ColorHong"
    }
  }
}
```

- 预期：
  - 创建 K3Label
  - 文本内容设置为 "确认退出"
  - 字体大小 22
  - 颜色设置为红色（ColorHong）

**例 3: 批量创建多个组件**

- 输入：

```json
{
  "batchId": "batch_create_multiple",
  "commands": [
    {
      "id": "cmd_create_button",
      "type": "k3prefab.createComponent",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "parentPath": "DialogMain/Panel_Content",
        "componentType": "K3Button"
      }
    },
    {
      "id": "cmd_create_label",
      "type": "k3prefab.createComponent",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "parentPath": "DialogMain/Panel_Content",
        "componentType": "K3Label"
      }
    },
    {
      "id": "cmd_create_image",
      "type": "k3prefab.createComponent",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "parentPath": "DialogMain/Panel_Content",
        "componentType": "K3Image"
      }
    }
  ]
}
```

- 预期：
  - 三个命令都成功
  - K3ID 连续分配（例如 6, 7, 8）
  - `totalCommands=3, successCount=3`

### 5.2 边缘情况示例

**例 4: 创建组件时父节点路径错误**

- 输入：

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "parentPath": "DialogMain/InvalidPath",
    "componentType": "K3Button"
  }
}
```

- 预期：
  - `status=error`
  - `error.code=INVALID_PARENT_CONTAINER`

**例 5: 创建不支持的组件类型**

- 输入：

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "parentPath": "DialogMain/Panel_Content",
    "componentType": "InvalidType"
  }
}
```

- 预期：
  - `status=error`
  - `error.code=UNSUPPORTED_COMPONENT_TYPE`

**例 6: 设置不支持的初始属性**

- 输入：

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "parentPath": "DialogMain/Panel_Content",
    "componentType": "K3Label",
    "initialProperties": {
      "invalidProperty": "value"
    }
  }
}
```

- 预期：
  - 组件创建成功
  - `invalidProperty` 被忽略
  - 不影响创建结果

**例 7: 创建容器组件（K3Panel）**

- 输入：

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "parentPath": "DialogMain",
    "componentType": "K3Panel"
  }
}
```

- 预期：
  - 创建成功
  - K3Panel 本身也是一个容器（实现 IK3Container）
  - 新创建的 K3Panel 的 `maxID` 初始化为当前分配的 ID + 1

## 6. 验收清单（可执行）

### 6.1 批量命令框架相关

- [ ] 往`pending/`放入合法批量命令，json 会被处理，`results/`先出现 processing 再变 completed
- [ ] 批量命令中的`k3prefab.createComponent`命令执行成功
- [ ] 批量命令的批次级别统计字段正确：`totalCommands`、`successCount`、`failedCount`
- [ ] 部分成功模式：某个命令失败时，后续命令继续执行

### 6.2 k3prefab.createComponent 功能相关

**基本功能**：

- [ ] 创建 K3Button 成功，返回正确的 K3ID
- [ ] 创建 K3Label 成功，返回正确的 K3ID
- [ ] 创建 K3Image 成功，返回正确的 K3ID
- [ ] GameObject 名称正确（格式：组件类型\_ID）
- [ ] K3ID 连续分配（第一个组件 ID=父容器.maxID，第二个=父容器.maxID+1，以此类推）
- [ ] 父容器的 maxID 正确更新

**初始属性设置**：

- [ ] K3Label 的 text 属性设置成功
- [ ] K3Label 的 fontSize 属性设置成功
- [ ] K3Label 的 color 属性设置成功（使用颜色名称）
- [ ] K3Button 的 interactable 属性设置成功
- [ ] K3Button 的 alpha 属性设置成功
- [ ] K3Image 的 sprite 属性设置成功（从默认图集加载）
- [ ] 不支持的初始属性被忽略，不影响创建

**批量创建**：

- [ ] 批量创建多个组件，K3ID 连续分配
- [ ] 批量创建时，某个失败不影响其他组件创建
- [ ] 批量命令的统计正确

**容器组件**：

- [ ] 创建 K3Panel 成功
- [ ] 创建的 K3Panel 本身可以作为容器，继续创建子组件

**错误处理**：

- [ ] 预制体路径不存在时，`status=error`，`error.code=PREFAB_NOT_FOUND`
- [ ] 父节点路径不存在时，`status=error`，`error.code=INVALID_PARENT_CONTAINER`
- [ ] 父节点不是容器时，`status=error`，`error.code=INVALID_PARENT_CONTAINER`
- [ ] 组件类型不支持时，`status=error`，`error.code=UNSUPPORTED_COMPONENT_TYPE`

**保存验证**：

- [ ] 创建后预制体自动保存，`saved=true`
- [ ] 在 Unity 编辑器中打开预制体，可以看到新创建的组件
- [ ] 新创建的组件的属性与设置一致

### 6.3 模块化要求

- [ ] 新建`Assets/Editor/UnityAgentSkills/Plugins/K3Prefab/Handlers/K3PrefabCreateComponentHandler.cs`
- [ ] 在`K3PrefabPlugin.cs`中注册新命令
- [ ] 整个功能在 K3Prefab 模块内实现
- [ ] 不影响其他 UnityAgentSkills 功能

## 7. 技术实现要点

### 7.1 K3UI 组件创建逻辑

**创建流程**：

1. 加载预制体：使用现有的`PrefabLoader.LoadPrefab()`
2. 查找父节点：通过 `GameObjectPathFinder.FindGameObject()` 查找父节点
3. 验证父节点：检查父节点是否实现 `IK3Container` 接口
4. 创建组件：
   - 根据组件类型调用 `K3DefaultControls.CreateXXX()` 方法
   - 例如：`K3DefaultControls.CreateK3Button()`、`K3DefaultControls.CreateK3Label()` 等
5. 设置 K3Property：
   - 从父容器获取当前的 `property.maxID` 作为新组件的 ID
   - 设置新组件的 `property.ID = maxID`
   - 设置新组件的 `property.parentID = 父容器.property.ID`
   - 更新父容器的 `property.maxID++`
6. 设置初始属性：
   - 遍历 `initialProperties` 对象
   - 使用 `SerializedObject` 设置组件属性
7. 添加到父节点：
   - 使用 `GameObject.SetParent()` 设置父节点
   - 使用 `SetK3Property()` 统一设置 K3Property
8. 保存预制体：使用 `PrefabUtility.SaveAsPrefabAsset()`

**伪代码**：

```csharp
public static GameObject CreateK3Component(GameObject prefabRoot, string parentPath, string componentType, Dictionary<string, object> initialProperties)
{
    // 1. 查找父节点
    var parentGO = GameObjectPathFinder.FindGameObject(prefabRoot, parentPath);
    if (parentGO == null)
    {
        throw new Exception("父节点不存在");
    }

    // 2. 验证父节点是容器
    var container = parentGO.GetComponent<IK3Container>();
    if (container == null)
    {
        throw new Exception("父节点不是 K3 容器");
    }

    // 3. 创建组件
    GameObject componentGO = null;
    switch (componentType)
    {
        case "K3Button":
            componentGO = K3DefaultControls.CreateK3Button();
            break;
        case "K3Label":
            componentGO = K3DefaultControls.CreateK3Label();
            break;
        // ... 其他组件类型
        default:
            throw new Exception("不支持的组件类型");
    }

    // 4. 设置 K3Property
    SetK3Property(parentGO, container.property, componentGO.GetComponent<IK3Component>().property);

    // 5. 设置初始属性
    if (initialProperties != null && initialProperties.Count > 0)
    {
        SetComponentProperties(componentGO, initialProperties);
    }

    // 6. 添加到父节点
    componentGO.transform.SetParent(parentGO.transform, false);

    // 7. 命名
    var k3Comp = componentGO.GetComponent<IK3Component>();
    componentGO.name = componentType + "_" + k3Comp.property.ID;

    return componentGO;
}
```

### 7.2 代码组织建议

```
Assets/Editor/UnityAgentSkills/
├── Plugins/
│   └── K3Prefab/
│       ├── Handlers/
│       │   ├── K3PrefabQueryByK3IdHandler.cs           # 查询处理器
│       │   ├── K3PrefabSetComponentPropertiesHandler.cs # 修改处理器
│       │   └── K3PrefabCreateComponentHandler.cs        # 创建处理器【新增】
│       ├── Utils/
│       │   ├── K3ComponentFinder.cs                    # K3组件查找工具
│       │   ├── K3ComponentPropertyReader.cs            # K3组件属性读取
│       │   ├── K3ComponentPropertyModifier.cs           # K3组件属性修改
│       │   └── K3ComponentCreator.cs                   # K3组件创建工具【新增】
│       └── Models/
│           ├── K3ComponentMatch.cs                     # 匹配结果模型
│           ├── K3PropertyModification.cs               # 修改请求模型
│           └── K3ComponentCreationRequest.cs           # 创建请求模型【新增】
```

### 7.3 关键 API

| 功能类别   | API/方法                                         | 说明                        |
| ---------- | ------------------------------------------------ | --------------------------- |
| 预制体加载 | `PrefabLoader.LoadPrefab()`                      | 复用现有工具                |
| 节点查找   | `GameObjectPathFinder.FindGameObject()`          | 复用现有工具                |
| 组件创建   | `K3DefaultControls.CreateK3Button()`             | 创建按钮                    |
| 组件创建   | `K3DefaultControls.CreateK3Label()`              | 创建标签                    |
| 组件创建   | `K3DefaultControls.CreateK3Image()`              | 创建图片                    |
| 组件创建   | `K3DefaultControls.CreateK3Edit()`               | 创建输入框                  |
| 属性设置   | `SetK3Property()`                                | 复用 UIMenuOptions 中的方法 |
| 预制体保存 | `PrefabUtility.SaveAsPrefabAsset()`              | 保存预制体到磁盘            |
| 属性修改   | `SerializedObjectHelper.SetSerializedProperty()` | 复用现有工具                |

### 7.4 支持的组件类型与创建方法映射

| 组件类型          | 创建方法                                      |
| ----------------- | --------------------------------------------- |
| K3Label           | `K3DefaultControls.CreateK3Label()`           |
| K3Button          | `K3DefaultControls.CreateK3Button()`          |
| K3Panel           | `K3DefaultControls.CreateK3panel()`           |
| K3Image           | `K3DefaultControls.CreateK3Image()`           |
| K3Edit            | `K3DefaultControls.CreateK3Edit()`            |
| K3CheckBox        | `K3DefaultControls.CreateK3CheckBox()`        |
| K3LinkLabel       | `K3DefaultControls.CreateK3LinkLabel()`       |
| K3ListView        | `K3DefaultControls.CreateK3ListView()`        |
| K3Dialog          | `K3DefaultControls.CreateK3Dialog()`          |
| K3Dialog2         | `K3DefaultControls.CreateK3Dialog2()`         |
| K3TabButton       | `K3DefaultControls.CreateK3TabButton()`       |
| K3Tab             | `K3DefaultControls.CreateK3Tab()`             |
| K3ProgressBar     | `K3DefaultControls.CreateK3ProgressBar()`     |
| K3RadarChart      | `K3DefaultControls.CreateK3RadarChart()`      |
| K3HeadIcon        | `K3DefaultControls.CreateK3HeadIcon()`        |
| K3Itembox         | `K3DefaultControls.CreateK3Itembox()`         |
| K3LabelButton     | `K3DefaultControls.CreateK3LabelButton()`     |
| K3Animation       | `K3DefaultControls.CreateK3Animation()`       |
| K3SliderBar       | `K3DefaultControls.CreateK3SliderBar()`       |
| K3Movie           | `K3DefaultControls.CreateK3Movie()`           |
| K3NumImage        | `K3DefaultControls.CreateK3NumImage()`        |
| K3JoyStick        | `K3DefaultControls.CreateK3JoyStick()`        |
| K3Magicbox        | `K3DefaultControls.CreateK3Magicbox()`        |
| K3ExpandListView  | `K3DefaultControls.CreateK3ExpandListView()`  |
| K3ExpandListPanel | `K3DefaultControls.CreateK3ExpandListPanel()` |
| K3InsightImage    | `K3DefaultControls.CreateK3InsightImage()`    |

### 7.5 初始属性处理

**颜色名称映射**：

参考 `K3DefaultControls` 中定义的颜色常量：

```csharp
// K3Label不同类型对应的颜色
public static readonly Color32 NormalBai = new Color32(255, 240, 227, 255);
public static readonly Color32 Title = new Color32(229, 191, 143, 255);
public static readonly Color32 ColorHong = new Color32(250, 0, 0, 255);
public static readonly Color32 ColorLan = new Color32(0, 255, 222, 255);
// ... 更多颜色
```

支持的颜色名称：

- "NormalBai"
- "Title"
- "NameDanHuang"
- "IconZiAnHei"
- "ColorHong"
- "ColorLan"
- "ColorHuang"
- "ColorCheng"
- "ColorLv"
- "ColorFen"
- "ColorJingGaoHuang"
- "ColorWenZiHui"

**精灵图片加载**：

使用 `GetEditorSprite()` 方法从默认图集加载：

```csharp
const string editorAtlasPath = "Assets/Assets/ResourcesAB/UISprites/ui_common.png";
private static Sprite GetEditorSprite(string name)
{
    Sprite[] sprs = AssetDatabase.LoadAllAssetsAtPath(editorAtlasPath).OfType<Sprite>().ToArray();
    foreach (var spr in sprs)
    {
        if (spr.name == name)
        {
            return spr;
        }
    }
    return null;
}
```

### 7.6 参数验证要点

**k3prefab.createComponent**：

- 验证预制体路径存在且有效
- 验证父节点路径存在
- 验证父节点实现 `IK3Container` 接口
- 验证组件类型在支持列表中
- 验证 `initialProperties` 中的属性名和类型正确

## 8. 与现有命令的对比

### 8.1 功能对比

| 命令                              | 功能                   | 使用场景           |
| --------------------------------- | ---------------------- | ------------------ |
| `k3prefab.queryByK3Id`            | 通过 K3ID 查询 K3 组件 | 查看已有组件信息   |
| `k3prefab.setComponentProperties` | 修改 K3 组件属性       | 修改已有组件       |
| `k3prefab.createComponent`        | 创建新的 K3 组件       | 添加新组件到预制体 |

### 8.2 工作流示例

**完整工作流：创建 → 查询 → 修改**

1. 创建组件：

```json
{
  "type": "k3prefab.createComponent",
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "parentPath": "DialogMain/Panel_Content",
    "componentType": "K3Button",
    "initialProperties": {
      "interactable": true,
      "alpha": 1.0
    }
  }
}
```

2. 查询创建的组件：

```json
{
  "type": "k3prefab.queryByK3Id",
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "k3Id": 6
  }
}
```

3. 修改组件属性：

```json
{
  "type": "k3prefab.setComponentProperties",
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "k3Id": 6,
    "modifications": [
      {
        "property": "alpha",
        "oldValue": 1.0,
        "newValue": 0.5
      }
    ]
  }
}
```

## 9. 后续扩展方向

### 9.1 可能的扩展功能

- 批量创建多个相同类型的组件：`k3prefab.createMultipleComponents`
- 创建组件时自动添加事件绑定（如 K3Button 的点击事件）
- 创建组件时自动布局（使用 Unity Layout Group）
- 创建组件模板：从预制体模板创建组件
- 组件复制：复制已有组件到新位置

### 9.2 跨项目适配考虑

如果需要适配其他项目（不使用 K3 框架）：

1. 整个`k3prefab.createComponent`功能可以独立禁用（删除或注释 K3Prefab 插件）
2. 或者：
   - 抽象出组件创建接口：`IComponentCreator`
   - 实现 K3 框架适配器：`K3ComponentCreator`
   - 实现其他 UI 框架适配器：`UGUIComponentCreator`、`UI ToolkitComponentCreator`

但当前需求明确 K3 功能是项目特化的，不需要考虑跨项目适配。

---

**实现优先级**：

1. 第一阶段：支持基础组件创建（K3Button、K3Label、K3Image）
2. 第二阶段：支持所有编辑器菜单中的组件类型
3. 第三阶段：支持初始属性设置
4. 第四阶段：完善错误处理和边缘情况

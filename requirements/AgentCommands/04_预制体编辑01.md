# 需求文档 - 预制体编辑功能(GameObject 属性修改)

## 1. 项目现状与核心目标

### 1.1 用户需求简述

需要提供一个命令来修改 Unity 预制体中 GameObject 的属性:

**prefab.setGameObjectProperties**: 修改预制体中指定 GameObject 的属性(name, tag, layer, isActive 等)

### 1.2 项目现状

- 项目已有完善的 AgentCommands 命令系统,位于 `Code/Assets/Editor/AgentCommands/`
- 已实现预制体查看功能: `prefab.queryHierarchy` 和 `prefab.queryComponents`
- 已有模块化工具类: PrefabLoader, GameObjectPathFinder, SerializedObjectHelper 等
- 本命令需要与预制体查看功能搭配使用: 先用 `prefab.queryHierarchy` 查询获取 GameObject 的 instanceID 和路径, 再用本命令修改属性
- **插件化架构**: prefab 命令通过 `AgentCommands.Plugins.Prefab.PrefabCommandsPlugin` 提供(Priority 20)
- **实现文件**: `Code/Assets/Editor/AgentCommands/Plugins/Prefab/PrefabCommandsPlugin.cs`

### 1.3 核心目标

- 让外部工具通过写入批量命令的方式, 向 Unity Editor 发起"修改预制体中 GameObject 属性"的请求
- 支持修改 GameObject 的 8 种可修改属性
- 修改后自动保存预制体
- 支持批量修改多个 GameObject 的属性
- 返回修改后的 GameObject 完整信息, 便于验证修改结果

## 2. 范围与边界

### 2.1 功能点简述

**命令: prefab.setGameObjectProperties**

- [ ] 接收预制体路径和 GameObject 路径(instanceID), 定位目标对象
- [ ] 支持修改 GameObject 的多种属性(name, tag, layer, isActive, isStatic, hideFlags 等)
- [ ] 修改后自动保存预制体到磁盘
- [ ] 返回修改后的 GameObject 完整信息, 包含所有属性的最新值
- [ ] 支持批量修改多个 GameObject 的属性

### 2.2 GameObject 本身可修改的属性清单

GameObject 的属性是固定的, 只有以下 8 个可修改项:

| 序号 | 属性名           | 类型      | 说明                                                        |
| ---- | ---------------- | --------- | ----------------------------------------------------------- |
| 1    | **name**         | string    | 对象名称                                                    |
| 2    | **tag**          | string    | 标签, 用于物理碰撞、查询过滤等(如"Player"、"Enemy")         |
| 3    | **layer**        | int       | 层级, 用于物理碰撞、相机剔除、射线检测等(0-31)              |
| 4    | **isActive**     | bool      | 激活状态, 控制对象及其子对象的启用/禁用                     |
| 5    | **isStatic**     | bool      | 静态标记, 影响 Lightmap 烘焙、Occlusion Culling 等          |
| 6    | **hideFlags**    | HideFlags | 隐藏标志, 控制对象在 Inspector/Hierarchy/Project 中的可见性 |
| 7    | **navMeshLayer** | int       | 导航网格层(较少使用)                                        |
| 8    | **icon**         | Texture2D | 场景图标(较少使用)                                          |

**注意:**

- GameObject 的属性是固定的, 只有上述 8 个可修改项
- 与 Component 不同, GameObject 不支持自定义序列化字段
- 修改 `isActive` 会影响对象及其所有子对象的激活状态
- 参数中只需要提供要修改的属性, 未提供的属性保持不变

### 2.3 排除项

- 不支持修改 GameObject 属性之外的编辑(删除/添加/移动 GameObject 等功能后续需求)
- 不支持修改 Component 的属性(后续需求)
- 不支持修改运行时实例(仅支持预制体文件)
- 不支持创建新预制体(只修改已存在的预制体)

## 3. 输入协议

外部工具写入批量命令: `Assets/AgentCommands/pending/{batchId}.json`

批量命令的完整格式详见 `01_整体与框架需求.md`, 本节仅描述 `prefab.setGameObjectProperties` 命令的 `params` 部分。

批量命令中, `commands` 数组可以包含一个或多个 `prefab.setGameObjectProperties` 命令:

### 3.1 输入示例

```json
{
  "batchId": "batch_modify_goprops_001",
  "timeout": 30000,
  "commands": [
    {
      "id": "cmd_rename_button",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
        "properties": {
          "name": "K3Button_Confirm_New"
        }
      }
    },
    {
      "id": "cmd_set_layer",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Cancel",
        "properties": {
          "layer": 5,
          "isStatic": true
        }
      }
    },
    {
      "id": "cmd_modify_second_button",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
        "siblingIndex": 1,
        "properties": {
          "name": "K3Button_Confirm_Second"
        }
      }
    }
  ]
}
```

### 3.2 params 字段定义

`type = "prefab.setGameObjectProperties"` 时, `params` 必须包含:

| 参数名       | 类型   | 必填 | 说明                                                                                          |
| ------------ | ------ | ---- | --------------------------------------------------------------------------------------------- |
| prefabPath   | string | 是   | 预制体绝对路径                                                                                |
| objectPath   | string | 是   | GameObject 层级路径(如 "Root/Child/Grandchild"), 也可以使用 prefab.queryHierarchy 返回的 path |
| siblingIndex | int    | 否   | 同名对象索引(可选, 默认为 0), 用于定位同路径下的同名对象, 从 0 开始                           |
| properties   | object | 是   | 要修改的属性对象, 只包含需要修改的属性, 未提供的属性保持不变                                  |

**siblingIndex 参数说明**:

- **用途**: 当同一路径下存在多个同名 GameObject 时, 使用此参数精确定位
- **默认值**: 0 (定位第一个匹配的对象)
- **取值范围**: 从 0 开始 (0=第一个, 1=第二个, 以此类推)
- **示例场景**: 如果预制体中有两个名为 "K3Button_Confirm" 的按钮, 想修改第二个, 则设置 `siblingIndex: 1`
- **参考来源**: 可通过 `prefab.queryHierarchy` 返回的 `siblingIndex` 字段获取正确值

### 3.3 properties 对象字段定义

`properties` 对象支持以下字段(均为可选):

| 字段名       | 类型   | 说明                                                              |
| ------------ | ------ | ----------------------------------------------------------------- |
| name         | string | 对象名称                                                          |
| tag          | string | 标签(如 "Player", "Enemy", "Untagged")                            |
| layer        | int    | 层级(0-31)                                                        |
| isActive     | bool   | 激活状态(true=启用, false=禁用)                                   |
| isStatic     | bool   | 静态标记(true=静态, false=动态)                                   |
| hideFlags    | int    | 隐藏标志(枚举值, 0=None, 1=HideInHierarchy, 2=HideInInspector 等) |
| navMeshLayer | int    | 导航网格层(较少使用)                                              |
| icon         | object | 场景图标(较少使用, 格式为 { "instanceID": xxx })                  |

**注意:**

- 所有字段都是可选的, 只需要提供要修改的属性
- 未提供的属性保持原值不变
- `properties` 对象不能为空, 至少包含一个要修改的属性
- `hideFlags` 是枚举类型, 使用整数值: 0=None, 1=HideInHierarchy, 2=HideInInspector, 3=HideInHierarchy|HideInInspector 等

## 4. 输出协议

批量命令的输出协议详见 `01_整体与框架需求.md`, 本节仅描述 `prefab.setGameObjectProperties` 命令执行成功时的 `result` 结构。

当批量命令执行完成(`status=completed`)时, `results` 数组中每个 `type="prefab.setGameObjectProperties"` 的命令在 `status=success` 时, 其 `result` 结构如下:

### 4.1 result 字段定义

- `prefabPath`: string, 预制体路径(与输入一致)
- `objectPath`: string, GameObject 路径(与输入一致)
- `instanceID`: number, GameObject 的 Unity InstanceID(用于唯一标识)
- `modifiedProperties`: array, 实际修改的属性列表(只包含有变化的属性)
  - 每个元素包含: `name`(属性名), `oldValue`(修改前的值), `newValue`(修改后的值)
- `currentProperties`: object, GameObject 当前的所有属性值(修改后的最新状态)
- `saved`: boolean, 预制体是否已成功保存到磁盘

### 4.2 error 的典型情况

- 预制体路径不存在:

  - `status=error`
  - `error.code=PREFAB_NOT_FOUND`
  - `error.message` 为对非专业人士可读的说明(例如 "预制体文件不存在: Assets/notexist.prefab")

- GameObject 路径不存在:

  - `status=error`
  - `error.code=GAMEOBJECT_NOT_FOUND`
  - `error.message` 为对非专业人士可读的说明(例如 "在预制体中找不到对象: DialogMain/NotExistNode")

- 属性值类型错误:

  - `status=error`
  - `error.code=INVALID_PROPERTY_VALUE`
  - `error.message` 为对非专业人士可读的说明(例如 "layer 属性值必须是 0-31 之间的整数")

- 属性名称错误:

  - `status=error`
  - `error.code=UNKNOWN_PROPERTY`
  - `error.message` 为对非专业人士可读的说明(例如 "GameObject 不支持属性: unknownField")

- properties 对象为空:
  - `status=error`
  - `error.code=EMPTY_PROPERTIES`
  - `error.message` 为对非专业人士可读的说明(例如 "properties 对象不能为空, 至少需要指定一个要修改的属性")

### 4.3 输出示例

#### 成功示例

```json
{
  "batchId": "batch_modify_goprops_001",
  "status": "completed",
  "startedAt": "2026-01-31 10:00:00.000",
  "finishedAt": "2026-01-31 10:00:01.500",
  "results": [
    {
      "id": "cmd_rename_button",
      "type": "prefab.setGameObjectProperties",
      "status": "success",
      "startedAt": "2026-01-31 10:00:00.100",
      "finishedAt": "2026-01-31 10:00:00.800",
      "result": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
        "instanceID": 345678901,
        "modifiedProperties": [
          {
            "name": "name",
            "oldValue": "K3Button_Confirm",
            "newValue": "K3Button_Confirm_New"
          }
        ],
        "currentProperties": {
          "name": "K3Button_Confirm_New",
          "tag": "Untagged",
          "layer": 0,
          "isActive": true,
          "isStatic": false,
          "hideFlags": 0,
          "navMeshLayer": 0,
          "icon": null
        },
        "saved": true
      }
    },
    {
      "id": "cmd_set_layer",
      "type": "prefab.setGameObjectProperties",
      "status": "success",
      "startedAt": "2026-01-31 10:00:00.900",
      "finishedAt": "2026-01-31 10:00:01.400",
      "result": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Cancel",
        "instanceID": 456789012,
        "modifiedProperties": [
          {
            "name": "layer",
            "oldValue": 0,
            "newValue": 5
          },
          {
            "name": "isStatic",
            "oldValue": false,
            "newValue": true
          }
        ],
        "currentProperties": {
          "name": "K3Button_Cancel",
          "tag": "Untagged",
          "layer": 5,
          "isActive": true,
          "isStatic": true,
          "hideFlags": 0
        },
        "saved": true
      }
    }
  ],
  "totalCommands": 2,
  "successCount": 2,
  "failedCount": 0
}
```

#### 失败示例

**预制体不存在:**

```json
{
  "results": [
    {
      "id": "cmd_invalid_prefab",
      "type": "prefab.setGameObjectProperties",
      "status": "error",
      "error": {
        "code": "PREFAB_NOT_FOUND",
        "message": "预制体文件不存在: Assets/notexist.prefab",
        "detail": "请检查预制体路径是否正确"
      }
    }
  ]
}
```

**GameObject 路径不存在:**

```json
{
  "results": [
    {
      "id": "cmd_invalid_path",
      "type": "prefab.setGameObjectProperties",
      "status": "error",
      "error": {
        "code": "GAMEOBJECT_NOT_FOUND",
        "message": "在预制体中找不到对象: DialogMain/NotExistNode",
        "detail": "请使用 prefab.queryHierarchy 命令查询正确的 GameObject 路径"
      }
    }
  ]
}
```

**属性值类型错误:**

```json
{
  "results": [
    {
      "id": "cmd_invalid_layer",
      "type": "prefab.setGameObjectProperties",
      "status": "error",
      "error": {
        "code": "INVALID_PROPERTY_VALUE",
        "message": "layer 属性值无效: 999",
        "detail": "layer 属性值必须是 0-31 之间的整数"
      }
    }
  ]
}
```

## 5. 举例覆盖需求和边缘情况

### 5.1 基本使用示例

**例 1: 修改 GameObject 名称**

- pending 输入:

```json
{
  "batchId": "batch_rename_001",
  "commands": [
    {
      "id": "cmd_rename",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
        "properties": {
          "name": "K3Button_Confirm_New"
        }
      }
    }
  ]
}
```

- 预期:
  - GameObject 的名称从 "K3Button_Confirm" 改为 "K3Button_Confirm_New"
  - 返回 `modifiedProperties` 显示名称的变化
  - 返回 `currentProperties` 显示所有属性的当前值
  - `saved=true` 表示预制体已保存

**例 2: 同时修改多个属性**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Cancel",
    "properties": {
      "name": "CancelButton",
      "tag": "UI",
      "layer": 5,
      "isStatic": true,
      "isActive": true
    }
  }
}
```

- 预期:
  - 一次性修改 5 个属性
  - `modifiedProperties` 包含 5 个元素(如果有属性值确实发生了变化)
  - `currentProperties` 显示修改后的所有属性值

**例 3: 禁用 GameObject(及其子对象)**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content",
    "properties": {
      "isActive": false
    }
  }
}
```

- 预期:
  - `Panel_Content` 及其所有子对象被禁用
  - `currentProperties.isActive=false`
  - 修改后子对象在 Unity Inspector 中会显示为禁用状态

### 5.2 批量修改示例

**例 4: 批量修改多个 GameObject**

- pending 输入:

```json
{
  "batchId": "batch_multi_modify_001",
  "commands": [
    {
      "id": "cmd_btn_confirm",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
        "properties": {
          "name": "ConfirmButton",
          "tag": "UI"
        }
      }
    },
    {
      "id": "cmd_btn_cancel",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Cancel",
        "properties": {
          "name": "CancelButton",
          "tag": "UI"
        }
      }
    },
    {
      "id": "cmd_panel",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content",
        "properties": {
          "layer": 5
        }
      }
    }
  ]
}
```

- 预期:
  - 3 个 GameObject 的属性都被修改
  - `totalCommands=3`, `successCount=3`, `failedCount=0`
  - `results` 数组按输入顺序包含 3 个结果

### 5.3 边缘情况示例

**例 5: 修改为相同的值(无实际变化)**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
    "properties": {
      "name": "K3Button_Confirm"
    }
  }
}
```

- 假设当前 GameObject 的名称就是 "K3Button_Confirm"
- 预期:
  - 命令执行成功, `status=success`
  - `modifiedProperties` 为空数组(因为没有属性实际发生变化)
  - `saved=false` 或 `saved=true` 均可(取决于实现策略, 建议即使无变化也保存, 保持一致性)

**例 6: properties 为空对象**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
    "properties": {}
  }
}
```

- 预期:
  - `status=error`
  - `error.code=EMPTY_PROPERTIES`
  - `error.message="properties 对象不能为空, 至少需要指定一个要修改的属性"`

**例 7: 未知属性名称**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
    "properties": {
      "unknownField": "someValue"
    }
  }
}
```

- 预期:
  - `status=error`
  - `error.code=UNKNOWN_PROPERTY`
  - `error.message="GameObject 不支持属性: unknownField"`

**例 8: layer 属性值超出范围**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
    "properties": {
      "layer": 999
    }
  }
}
```

- 预期:
  - `status=error`
  - `error.code=INVALID_PROPERTY_VALUE`
  - `error.message="layer 属性值必须是 0-31 之间的整数, 当前值: 999"`

**例 9: 批量命令中部分失败**

- pending 输入:

```json
{
  "batchId": "batch_partial_fail_001",
  "commands": [
    {
      "id": "cmd_success",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
        "properties": {
          "name": "ConfirmButton"
        }
      }
    },
    {
      "id": "cmd_fail_path",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/NotExistNode",
        "properties": {
          "name": "Test"
        }
      }
    },
    {
      "id": "cmd_success_2",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Cancel",
        "properties": {
          "name": "CancelButton"
        }
      }
    }
  ]
}
```

- 预期:
  - `cmd_success`: 成功
  - `cmd_fail_path`: 失败, `error.code=GAMEOBJECT_NOT_FOUND`
  - `cmd_success_2`: 成功(继续执行后续命令)
  - `totalCommands=3`, `successCount=2`, `failedCount=1`

**例 10: 与 prefab.queryHierarchy 搭配使用**

典型工作流程:

1. 先查询预制体层级:

```json
{
  "batchId": "batch_query_001",
  "commands": [
    {
      "id": "cmd_query",
      "type": "prefab.queryHierarchy",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab"
      }
    }
  ]
}
```

2. 从查询结果中获取 GameObject 的路径和 instanceID, 然后修改属性:

```json
{
  "batchId": "batch_modify_001",
  "commands": [
    {
      "id": "cmd_modify",
      "type": "prefab.setGameObjectProperties",
      "params": {
        "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
        "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
        "properties": {
          "name": "ConfirmButton",
          "layer": 5
        }
      }
    }
  ]
}
```

### 5.4 特殊属性示例

**例 11: 设置 hideFlags**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
    "properties": {
      "hideFlags": 1
    }
  }
}
```

- hideFlags 枚举值:

  - 0: None (正常显示)
  - 1: HideInHierarchy (在 Hierarchy 面板中隐藏)
  - 2: HideInInspector (在 Inspector 面板中隐藏)
  - 3: HideInHierarchy | HideInInspector (完全隐藏)

- 预期:
  - GameObject 在 Unity Hierarchy 面板中隐藏
  - `currentProperties.hideFlags=1`

**例 12: 设置 tag 为预定义标签**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
    "properties": {
      "tag": "Player"
    }
  }
}
```

- Unity 预定义标签: "Untagged", "Respawn", "Finish", "EditorOnly", "MainCamera", "Player", "Enemy" 等
- 如果 tag 不存在, 可以先在 Unity Editor 的 Tag Manager 中添加自定义标签

- 预期:
  - GameObject 的 tag 设置为 "Player"
  - `currentProperties.tag="Player"`

**例 13: 修改 navMeshLayer**

- pending 输入:

```json
{
  "params": {
    "prefabPath": "Assets/ResourcesAB/UIPrefabs/DialogMain.prefab",
    "objectPath": "DialogMain/Panel_Content/K3Button_Confirm",
    "properties": {
      "navMeshLayer": 2
    }
  }
}
```

- 预期:
  - GameObject 的导航网格层设置为 2
  - `currentProperties.navMeshLayer=2`

## 6. 验收清单(可执行)

### 6.1 批量命令框架相关

- [ ] 往 `pending/` 放入 1 个合法批量命令, json 会被处理, `results/` 先出现 processing 再变 completed
- [ ] 批量命令中的 `prefab.setGameObjectProperties` 命令执行成功后, `results` 数组中对应元素的 `status=success`
- [ ] 批量命令的批次级别统计字段正确: `totalCommands`, `successCount`, `failedCount`
- [ ] 部分成功模式: 某个 `prefab.setGameObjectProperties` 命令失败时, 后续命令继续执行

### 6.2 prefab.setGameObjectProperties 功能相关

**基本功能:**

- [ ] 修改 GameObject 名称, `result.currentProperties.name` 显示新名称
- [ ] 修改 GameObject tag, `result.currentProperties.tag` 显示新标签
- [ ] 修改 GameObject layer, `result.currentProperties.layer` 显示新层级(0-31)
- [ ] 修改 GameObject isActive, `result.currentProperties.isActive` 显示新状态
- [ ] 修改 GameObject isStatic, `result.currentProperties.isStatic` 显示新状态
- [ ] 修改 GameObject hideFlags, `result.currentProperties.hideFlags` 显示新值
- [ ] 同时修改多个属性, 所有属性都正确修改
- [ ] 返回的 `result.modifiedProperties` 只包含实际发生变化的属性
- [ ] 返回的 `result.currentProperties` 包含所有属性的当前值(修改后)
- [ ] 返回的 `result.saved=true` 表示预制体已保存到磁盘

**错误处理:**

- [ ] 预制体路径不存在时, 返回 `status=error`, `error.code=PREFAB_NOT_FOUND`
- [ ] GameObject 路径不存在时, 返回 `status=error`, `error.code=GAMEOBJECT_NOT_FOUND`
- [ ] properties 对象为空时, 返回 `status=error`, `error.code=EMPTY_PROPERTIES`
- [ ] 提供未知属性名称时, 返回 `status=error`, `error.code=UNKNOWN_PROPERTY`
- [ ] layer 属性值超出 0-31 范围时, 返回 `status=error`, `error.code=INVALID_PROPERTY_VALUE`
- [ ] 属性值类型不匹配时, 返回 `status=error`, `error.code=INVALID_PROPERTY_VALUE`

**边缘情况:**

- [ ] 修改属性为相同值时, 命令成功, `modifiedProperties` 为空(无实际变化)
- [ ] 修改 isActive=false 时, GameObject 及其子对象被禁用
- [ ] 批量命令中包含多个 `prefab.setGameObjectProperties` 命令时, 所有命令按顺序执行
- [ ] 批量命令中部分命令失败时, 其他命令继续执行(部分成功模式)

**集成测试:**

- [ ] 先用 `prefab.queryHierarchy` 查询预制体, 再用 `prefab.setGameObjectProperties` 修改属性, 工作流程正常
- [ ] 修改属性后重新查询预制体, 新属性值正确反映在查询结果中
- [ ] 在 Unity Editor 中手动打开预制体, 确认属性已正确修改并保存

## 7. 技术实现要点

### 7.1 实现方案

- 复用现有的模块化工具类: PrefabLoader, GameObjectPathFinder 等
- 使用 Unity 的 SerializedObject 系统读取和修改 GameObject 属性
- 修改后使用 `PrefabUtility.SaveAsPrefabAsset()` 保存预制体
- 使用 `AssetDatabase.Refresh()` 刷新资产数据库
- 支持 Undo 操作: 使用 `Undo.RecordObject()` 记录修改

### 7.2 代码组织建议

```
Assets/Editor/AgentCommands/
├── Handlers/
│   ├── PrefabQueryHierarchyHandler.cs       # 已有
│   ├── PrefabQueryComponentsHandler.cs      # 已有
│   └── PrefabSetGameObjectPropertiesHandler.cs  # 新增
├── Utils/
│   ├── PrefabLoader.cs                      # 已有, 复用
│   ├── GameObjectPathFinder.cs              # 已有, 复用
│   ├── SerializedObjectHelper.cs            # 已有, 扩展(支持写入属性)
│   └── GameObjectPropertyModifier.cs        # 新增, GameObject属性修改工具
└── Models/
    └── GameObjectProperties.cs               # 新增, GameObject属性定义
```

### 7.3 关键 API

| 功能类别   | API/方法                                           | 说明               |
| ---------- | -------------------------------------------------- | ------------------ |
| 预制体加载 | `PrefabLoader.LoadPrefab()`                        | 复用现有工具       |
| 对象定位   | `GameObjectPathFinder.FindByPath()`                | 复用现有工具       |
| 属性读取   | `SerializedObjectHelper.GetSerializedProperties()` | 复用现有工具       |
| 属性写入   | `SerializedObjectHelper.SetSerializedProperty()`   | 新增, 写入单个属性 |
| 预制体保存 | `PrefabUtility.SaveAsPrefabAsset()`                | 保存预制体到磁盘   |
| 记录撤销   | `Undo.RecordObject()`                              | 支持编辑器撤销操作 |
| 刷新数据库 | `AssetDatabase.Refresh()`                          | 刷新资产数据库     |

### 7.4 参数验证要点

- 验证预制体路径存在且有效
- 验证 GameObject 路径存在且可定位
- 验证 properties 对象不为空
- 验证属性名称是否在 8 个可修改属性列表中
- 验证属性值类型正确(layer 为 int, isActive 为 bool 等)
- 验证属性值在有效范围内(layer 为 0-31, tag 为已定义的标签等)

====================================已完成=============================
